#include "wmmintrin.h"
#include "smmintrin.h"
#include <stdio.h>
#include <stdint.h>
#include <string.h>
#include "print.h"
#include "encrypt.h"
//#define lengthA 16
//#define lengthN 16
//#define lengthT 16
//#define lengthM 16
//unsigned char key[16] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
//unsigned char IV[16] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
//unsigned char adata[lengthA] = {0x00,0x11,0x22,0x33,0x44,0x55,0x66,0x77,0x88,0x99,0xaa,0xbb,0xcc,0xdd,0xee,0xff};
//unsigned char constant[32] = {0x00,0x01,0x01,0x02,0x03,0x05,0x08,0x0d,0x15,0x22,0x37,0x59,0x90,0xe9,0x79,0xdb,0x3d,0x18,0x55,0x6d,0xc2,0x2f,0xf1,0x20,0x11,0x31,0x42,0x73,0xb5,0x28,0xdd};
//unsigned char plain[lengthM] = {0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
//unsigned char cipher[lengthM];// = {0x4e,0x23,0xb0,0xf5,0xe5,0x9a,0xac,0xa5,0x55,0x50,0x7f,0x24,0x6a,0xc4,0x85,0x9e};
//unsigned char decrypted[lengthM];// = {0x00,0x11,0x22,0x33,0x44,0x55,0x66,0x77,0x88,0x99,0xaa,0xbb,0xcc,0xdd,0xee,0xff};
//unsigned char tag[lengthT];
  #define lengthA 16
  #define lengthN 16
  #define lengthT 16
  #define lengthM 16
  const unsigned char key[16] = {0x7f,0x7e,0x7d,0x7c,0x7b,0x7a,0x79,0x78,0x77,0x76,0x75,0x74,0x73,0x72,0x71,0x70};
  unsigned char adata[lengthA] = {0x00,0x11,0x22,0x33,0x44,0x55,0x66,0x77,0x88,0x99,0xaa,0xbb,0xcc,0xdd,0xee,0xff};
  unsigned char nonce[16] = {0x09,0xf9,0x11,0x02,0x9d,0x74,0xe3,0x5b,0xd8,0x41,0x56,0xc5,0x63,0x56,0x88,0xc0};
  unsigned char plain[lengthM] = {0x74,0x68,0x69,0x73,0x20,0x69,0x73,0x20,0x73,0x6f,0x6d,0x65,0x20,0x70,0x6c,0x61};
  unsigned char cipher[lengthM];// ={0x63,0xbb,0x6f,0xef,0x9b,0x32,0x10,0xaa,0x76,0x0d,0xd2,0x84,0xc1,0xb0,0x5e,0x55};
  unsigned long long tag[lengthT];// = {0x92,0xca ,0x38,0x16 ,0x0c,0x25 ,0xc0,0x9c ,0xab,0xfd ,0x2c,0xc4 ,0x51,0x0a ,0x28,0x61};

// #define lengthA 26
// #define lengthN 16
// #define lengthT 16
// #define lengthM 26
// const unsigned char key[16] = {0x7f,0x7e,0x7d,0x7c,0x7b,0x7a,0x79,0x78,0x77,0x76,0x75,0x74,0x73,0x72,0x71,0x70};
// unsigned char adata[lengthA] = {0x00,0x11,0x22,0x33,0x44,0x55,0x66,0x77,0x88,0x99,0xaa,0xbb,0xcc,0xdd,0xee,0xff,0xff,0xee,0xdd,0xcc,0xbb,0xaa,0x99,0x88,0x77,0x66};
// unsigned char nonce[16] = {0x09,0xf9,0x11,0x02,0x9d,0x74,0xe3,0x5b,0xd8,0x41,0x56,0xc5,0x63,0x56,0x88,0xc0};
// unsigned char plain[lengthM] =  {0x74,0x68,0x69,0x73,0x20,0x69,0x73,0x20,0x73,0x6f,0x6d,0x65,0x20,0x70,0x6c,0x61,0x69,0x6e,0x74,0x65,0x78,0x74,0x20,0x74,0x6f,0x20};
// unsigned char cipher[lengthM];// = {0x63,0xbb ,0x6f,0xef ,0x9b,0x32 ,0x10,0xaa ,0x76,0x0d ,0xd2,0x84 ,0xc1,0xb0 ,0x5e,0x55 ,0x39,0x61 ,0xd8,0x27 ,0xb9,0x14 ,0x0b,0xa5 ,0xde,0xc5};
   unsigned char decrypted[lengthM];
// unsigned char tag[lengthT];//={0x83,0x94 ,0x67,0x36 ,0x08,0x64 ,0x61,0xfd ,0x3c,0xae ,0xa2,0x51 ,0x7a,0xba ,0x89,0xc4};



int main(){
  int succes;
  printchar((unsigned char*)key,16,"key");
  printchar(nonce,16,"nonce");
  printchar(adata,lengthA,"adata");

  printchar(plain,lengthM,"plain");
  //encrypt(key,IV,adata, plain,cipher, tag, lengthA*8,lengthM*8);
  crypto_aead_encrypt(cipher,tag,plain,lengthM,adata,lengthA,0,nonce,key);
  printchar(cipher,lengthM+1,"cipher");
  printchar(cipher+lengthM,16,"tag");

  //crypto_aead_decrypt(decrypted,cipher +lengthM ,cipher,lengthM,atest,lengthA,0,nonce,key);
  
  succes = crypto_aead_decrypt(decrypted,0, 0, cipher,lengthM,   adata,lengthA,   nonce,key );
  printf("succes = %i\n",succes);
  printchar(decrypted,lengthM,"decrypt");
  return 0;
}


